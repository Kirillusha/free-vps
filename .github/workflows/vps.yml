- name: Create Public Tunnel with Serveo
  run: |
    # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ SSH-ÑÐµÑ€Ð²ÐµÑ€ Ð² Ñ„Ð¾Ð½Ðµ (ÐµÑÐ»Ð¸ ÐµÑ‰Ñ‘ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½)
    sudo service ssh restart

    # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Serveo â€” Ð¿Ñ€Ð¾Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ Ð¿Ð¾Ñ€Ñ‚ 22 Ð½Ð° Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ URL
    # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ nohup Ð¸ /dev/null Ð´Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð³Ð¾ Ñ„Ð¾Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
    nohup ssh -R 80:localhost:22 serveo.net > tunnel.log 2>&1 &

    # Ð–Ð´Ñ‘Ð¼, Ð¿Ð¾ÐºÐ° Serveo ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ URL
    sleep 15

    # Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ URL Ð¸Ð· Ð»Ð¾Ð³Ð°
    URL=$(grep -oP 'https?://\S+\.serveo\.net' tunnel.log | head -1)

    if [ -z "$URL" ]; then
      echo "âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ‚ÑƒÐ½Ð½ÐµÐ»ÑŒ. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ð»Ð¾Ð³:"
      cat tunnel.log
      exit 1
    fi

    # Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
    echo "âœ… VPS ÐÐšÐ¢Ð˜Ð’Ð•Ð!"
    echo "ðŸŒ ÐŸÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ URL: $URL"
    echo "ðŸ‘¤ Ð›Ð¾Ð³Ð¸Ð½: root"
    echo "ðŸ”‘ ÐŸÐ°Ñ€Ð¾Ð»ÑŒ: MySuperSecretPassword123"
    echo "â³ Ð¡ÐµÑ€Ð²ÐµÑ€ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ 6 Ñ‡Ð°ÑÐ¾Ð²."

    # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚
    mkdir -p artifacts
    echo "URL=$URL" > artifacts/connection.txt
    echo "LOGIN=root" >> artifacts/connection.txt
    echo "PASSWORD=MySuperSecretPassword123" >> artifacts/connection.txt

- name: Upload Connection Info
  uses: actions/upload-artifact@v3
  with:
    name: vps-connection
    path: artifacts/connection.txt
